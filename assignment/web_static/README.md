# 实时场景（web_static）

该目录实现了全新的“实时场景”可视化，针对不同楼层数、不同电梯数量、不同载重与乘客规模做了自适应设计，并重点修复了对齐问题。

## 设计要点

- 单一几何坐标系：坐标轴、楼层线、电梯通道共享同一套内边距（top/left/right/bottom）与 `innerHeight`，完全对齐。
- 自适应缩放：可通过“缩放”滑块在 70%–140% 间调整，支持一键重置视图。
- 高楼层密度策略：楼层数 > 32 时自动稀疏标签（保留关键楼层与等间隔标签），避免拥挤。
- 动画与速度：所有动画速度受 `--speed-factor` 控制，随页面右上角速度按钮联动。
- 无障碍：若系统开启“减少动态效果”，自动降低动画时长与频率。

## 关键文件

- `index.html` 页面骨架与控件
- `style.css` 视觉风格与布局（包含坐标轴、电梯通道、楼层线、卡片等）
- `main.js` 运行时渲染逻辑（StageRenderer）、轮询后端状态与交互逻辑

## 与后端的配合

- 通过 `assignment/web_dashboard.py` 提供的接口获取模拟器状态（`/dashboard/state`）与测试用例列表。
- 若切换测试用例或启动/停止调度，前端会自动刷新并重建布局，保证几何对齐。

## 对齐修复说明（本次重构）

1. 将 `.scene-floor-lines` 与 `.scene-elevator-layer` 的定位从 `inset: 0` 改为明确的 `top/bottom/left/right`，值均来自 `--scene-padding-*` 与 `--scene-inner-height`，彻底消除楼层线、电梯轿厢与坐标轴之间的像素级错位。
2. `main.js` 中移除了对楼层线容器的 `height` 直接写入，避免与 `inset` 规则冲突导致的偏移。
3. 加入楼层标签密度策略与激活高亮，使大规模楼层下仍保持清晰可读。

## 本地启动

```bash
python -m assignment.web_dashboard
# 浏览器访问 http://127.0.0.1:8050
```

在页面中选择“测试用例”，点击“启动调度”即可开始观察实时状态。

## 已知事项

- 超过 80 层时建议使用 90%–100% 的缩放并配合浏览器窗口最大化，以获得最佳可读性；
- 若你的浏览器开启了“减少动态效果”，一些细节动画会被弱化属于预期表现。

